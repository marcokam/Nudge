{"version":3,"file":"CalendarHeatmap.js","sourceRoot":"","sources":["../../../../Components/Calendar/Heatmap/CalendarHeatmap.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\r\nimport { getDay, getMonth, endOfMonth, differenceInCalendarDays, isFirstDayOfMonth } from \"date-fns\";\r\nimport { range, filterUndef } from \"~/Util/fp/array\";\r\n\r\ninterface HeatmapValue {\r\n    date: Date;\r\n}\r\ninterface FirstOfMonthWeek {\r\n    isFirstOfMonth: boolean;\r\n    date: Date;\r\n}\r\ntype WeekDay = 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7;\r\ntype Weeks = WeekDay[][];\r\ninterface CalendarHeatmapProps {\r\n    monthNames: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"];\r\n    weekdayNames: [\"\", \"M\", \"T\", \"W\", \"T\", \"F\", \"\"];\r\n    boxSize: 10;\r\n    gutterSize: 1;\r\n    fontSize: 6;\r\n    padding: 5;\r\n    values: HeatmapValue[];\r\n    showWeekdayLabels: true;\r\n    classForValue: (h: HeatmapValue) => string;\r\n    onMouseOver: (e: React.MouseEvent<SVGRectElement, MouseEvent>, h: HeatmapValue) => void;\r\n    onMouseLeave: (e: React.MouseEvent<SVGRectElement, MouseEvent>, h: HeatmapValue) => void;\r\n    transformDayElement: (el: JSX.Element, h: HeatmapValue, i: number) => JSX.Element;\r\n}\r\n\r\nexport default class CalendarHeatmap extends Component<CalendarHeatmapProps> {\r\n    static defaultProps = {\r\n        monthNames: [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"],\r\n        weekdayNames: [\"\", \"M\", \"T\", \"W\", \"T\", \"F\", \"\"],\r\n        boxSize: 10,\r\n        gutterSize: 1,\r\n        fontSize: 6,\r\n        padding: 5,\r\n        values: [],\r\n        showWeekdayLabels: true,\r\n        classForValue: () => \"\",\r\n        onMouseOver: () => { },\r\n        onMouseLeave: () => { },\r\n        transformDayElement: (el: JSX.Element) => el,\r\n    };\r\n\r\n    render() {\r\n        const { boxSize, gutterSize, padding, fontSize } = this.props;\r\n        const { weeks, firstOfMonthWeeks } = this.getWeeks();\r\n        const width = 7 * (boxSize + gutterSize) + padding * 2 + fontSize * 1.5;\r\n        const height = weeks.length * (boxSize + gutterSize) + padding * 3 + fontSize;\r\n        return (\r\n            <svg className=\"react-calendar-heatmap w-90\" viewBox={`0 0 ${width} ${height}`}>\r\n                {this.renderWeekdayLabels()}\r\n                {this.renderMonthLabels(weeks, firstOfMonthWeeks)}\r\n                {this.renderCalendar(weeks)}\r\n            </svg>\r\n        );\r\n    }\r\n    renderWeekdayLabels = () => {\r\n        const { weekdayNames, boxSize, gutterSize, padding, fontSize } = this.props;\r\n        const transform = `translate(${padding + fontSize * 1.5}, 0)`;\r\n        return (\r\n            <g style={{ fontSize }} transform={transform}>\r\n                {weekdayNames.map((name, index) =>\r\n                    name ? (\r\n                        <text key={`weekdayLabel_${index}`} x={index * (boxSize + gutterSize) + boxSize / 2} y={1 * boxSize} textAnchor=\"middle\">\r\n                            {name}\r\n                        </text>\r\n                    ) : null,\r\n                )}\r\n            </g>\r\n        );\r\n    };\r\n    renderMonthLabels = (weeks: Weeks, firstOfMonthWeeks: FirstOfMonthWeek[]) => {\r\n        const { monthNames, boxSize, gutterSize, padding, fontSize } = this.props;\r\n        const weekIndexesForLabels = filterUndef(firstOfMonthWeeks\r\n            .map(({ isFirstOfMonth, date }, index) => isFirstOfMonth ? { label: monthNames[getMonth(date)], index } : undefined));\r\n        const transform = `translate(0, ${padding * 2 + fontSize / 2})`;\r\n\r\n        return (\r\n            <g style={{ fontSize }} transform={transform}>\r\n                {weekIndexesForLabels.map(({ label, index } = { label: \"Jan\", index: 0 }) => {\r\n                    return (\r\n                        <text key={index} x={0} y={(index + 1) * (boxSize + gutterSize) - gutterSize * 2}>{label}</text>\r\n                    );\r\n                })}\r\n            </g>\r\n        );\r\n    };\r\n    renderCalendar = (weeks: Weeks) => {\r\n        const {\r\n            boxSize,\r\n            gutterSize,\r\n            padding,\r\n            fontSize,\r\n            values,\r\n            transformDayElement,\r\n            classForValue,\r\n            onMouseOver,\r\n            onMouseLeave,\r\n        } = this.props;\r\n        const mainTransform = `translate(${padding + fontSize * 1.5}, ${boxSize + padding})`;\r\n        const firstWeekShift = weeks.length > 0 && weeks[0].length > 0 && weeks[0][0] || 0;\r\n\r\n        return (\r\n            <g transform={mainTransform}>\r\n                {weeks.map((week, weekIndex) => {\r\n                    const weekTransform = `translate(0, ${weekIndex * (boxSize + gutterSize)})`;\r\n                    return (\r\n                        <g key={`week_${weekIndex}`} transform={weekTransform}>\r\n                            {week.map((day, dayIndex) => {\r\n                                const index = weekIndex * 7 + day - firstWeekShift;\r\n                                const vIndex = values.length - 1 - index;\r\n                                const value = values[vIndex];\r\n                                const className = classForValue(value);\r\n                                const element = (\r\n                                    <rect\r\n                                        key={`day_${dayIndex}`}\r\n                                        className={className}\r\n                                        width={boxSize}\r\n                                        height={boxSize}\r\n                                        x={day * (boxSize + gutterSize)}\r\n                                        y={0}\r\n                                        onMouseOver={event => onMouseOver(event, value)}\r\n                                        onMouseLeave={event => onMouseLeave(event, value)}\r\n                                    />\r\n                                );\r\n                                return transformDayElement(element, value, index);\r\n                            })}\r\n                        </g>\r\n                    );\r\n                })}\r\n            </g>\r\n        );\r\n    };\r\n\r\n    getStartEndDates = () => {\r\n        const { values } = this.props;\r\n        let startDate, endDate;\r\n        if (values.length > 0) {\r\n            startDate = values[values.length - 1].date;\r\n            endDate = values[0].date;\r\n        } else {\r\n            startDate = new Date();\r\n            endDate = endOfMonth(startDate);\r\n        }\r\n        return { startDate, endDate };\r\n    }\r\n    getWeeks = () => {\r\n        const { values } = this.props;\r\n        const reversedValues = [...values].reverse();\r\n        const firstOfMonth = reversedValues.map(v => isFirstDayOfMonth(v.date));\r\n        const { startDate, endDate } = this.getStartEndDates();\r\n        const startDay = getDay(startDate);\r\n        const daysToShow = differenceInCalendarDays(endDate, startDate) + 1;\r\n        const days = range(startDay, daysToShow + startDay).map(d => d % 7) as unknown as WeekDay[];\r\n        const firstOfMonthWeeks: FirstOfMonthWeek[] = [];\r\n        const weeks = days.reduce((acc, d, i) => {\r\n            let lastWeek = acc[acc.length - 1];\r\n            if (!lastWeek || lastWeek.length === 7 || d === 0) {\r\n                lastWeek = [];\r\n                acc.push(lastWeek);\r\n                firstOfMonthWeeks.push({ isFirstOfMonth: firstOfMonth[i], date: reversedValues[i].date });\r\n            }\r\n            lastWeek.push(d);\r\n            const lastMonthWeeks = firstOfMonthWeeks[firstOfMonthWeeks.length - 1];\r\n            if (!lastMonthWeeks.isFirstOfMonth && firstOfMonth[i]) {\r\n                lastMonthWeeks.isFirstOfMonth = true;\r\n                lastMonthWeeks.date = reversedValues[i].date;\r\n            }\r\n\r\n            return acc;\r\n        }, [] as Weeks);\r\n\r\n        // Show first month label if first label falls on 3rd row or after\r\n        const minFirstOfMonthIndex = firstOfMonthWeeks.reduce((acc, fom, fomIndex) => fom.isFirstOfMonth ? fomIndex : acc, Infinity);\r\n        if (minFirstOfMonthIndex >= 2 && firstOfMonthWeeks[0]) {\r\n            firstOfMonthWeeks[0].isFirstOfMonth = true;\r\n        }\r\n\r\n        // Don't show last label if first of month falls on last line\r\n        if (firstOfMonthWeeks[firstOfMonthWeeks.length - 1]) {\r\n            firstOfMonthWeeks[firstOfMonthWeeks.length - 1].isFirstOfMonth = false;\r\n        }\r\n\r\n        return { weeks, firstOfMonthWeeks };\r\n    };\r\n}\r\n"]}