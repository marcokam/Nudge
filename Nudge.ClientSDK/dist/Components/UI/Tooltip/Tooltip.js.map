{"version":3,"file":"Tooltip.js","sourceRoot":"","sources":["../../../../Components/UI/Tooltip/Tooltip.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useRef, useEffect, useState } from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport { numCompareByDir } from \"~/Util/sortUtils\";\r\nimport { Compare } from \"~/Util/fp/Instances/Compare\";\r\n\r\ninterface TooltipProps {\r\n    parent: Element | null;\r\n    targetSelector: string;\r\n    hide: () => void;\r\n    className?: string;\r\n    bounds?: Partial<ClientRect>;\r\n}\r\n\r\nexport const Tooltip: React.FunctionComponent<TooltipProps> = ({ children, parent, targetSelector, hide, className = \"\", ...restProps }) => {\r\n    const [target, setTarget] = useState();\r\n    const [selfBounds, setSelfBounds] = useState({ width: 0 });\r\n\r\n    // focus when shown\r\n    const portalRef = useRef(null);\r\n    useEffect(() => {\r\n        const el = portalRef.current;\r\n        const target = document.querySelector(targetSelector);\r\n        if (!el || !target) return;\r\n        (el as HTMLElement).focus();\r\n        const bounds = (el as HTMLElement).getBoundingClientRect();\r\n        setSelfBounds(bounds);\r\n        setTarget(target);\r\n\r\n        const onClick = (event: Event) => {\r\n            if (!(event.target as Element).closest(`div.NudgeTooltip`)) {\r\n                hide();\r\n            }\r\n        }\r\n        document.addEventListener(\"click\", onClick, { capture: true, passive: true })\r\n        return () => {\r\n            document.removeEventListener(\"click\", onClick, { capture: true });\r\n        }\r\n    }, [hide, targetSelector]);\r\n\r\n    // remove when any scroll events happen\r\n    // also hide when escape is used\r\n    useEffect(() => {\r\n        const hideOnEscape = (event: KeyboardEvent) => {\r\n            if (event && event.keyCode === 27) {\r\n                hide();\r\n            }\r\n        }\r\n        document.addEventListener(\"scroll\", hide, { capture: true, once: true, passive: true });\r\n        document.addEventListener(\"keyup\", hideOnEscape, { capture: true, passive: true });\r\n        return () => {\r\n            document.removeEventListener(\"scroll\", hide, { capture: true });\r\n            document.removeEventListener(\"keyup\", hideOnEscape, { capture: true });\r\n        };\r\n    }, [hide]);\r\n\r\n    const allClassNames = `NudgeTooltip fixed border-box ${className}`;\r\n\r\n    /**\r\n     * We have the bounds of a parent and target element.  We want to calculate the best placement for this tooltip by calculating\r\n     *   which direction has the most room between the bounds of the target and the parent.\r\n     */\r\n    const parentNode = parent ? parent : document.body;\r\n    const parentBounds = parentNode && parentNode.getBoundingClientRect() || { top: 0, left: 0, right: Infinity, bottom: Infinity };\r\n    const bounds = target && target.getBoundingClientRect();\r\n    const leftSpace = bounds && (bounds.left - parentBounds.left);\r\n    const rightSpace = bounds && (parentBounds.right - bounds.right);\r\n    const byValue = Compare.of(numCompareByDir(false))\r\n        .contramap<[string, number]>(([_, s]) => s);\r\n    const bestX = ([[\"left\", leftSpace], [\"right\", rightSpace]] as [string, number][])\r\n        .sort(byValue.run)\r\n        .map(([dir]) => dir)\r\n        .shift();\r\n    const topSpace = bounds && (bounds.top - parentBounds.top);\r\n    const bottomSpace = bounds && (parentBounds.bottom - bounds.bottom);\r\n    const bestY = ([[\"top\", topSpace], [\"bottom\", bottomSpace]] as [string, number][])\r\n        .sort(byValue.run)\r\n        .map(([dir]) => dir)\r\n        .shift();\r\n    const portalChildren = (\r\n        <div\r\n            ref={portalRef}\r\n            tabIndex={0}\r\n            // onBlur={hide}\r\n            className={allClassNames}\r\n            style={{\r\n                opacity: selfBounds.width === 0 ? 0 : 1,\r\n                top: (bestY === \"top\" || !bounds) ? \"auto\" : bounds.top,\r\n                bottom: (bestY === \"top\" && bounds) ? window.innerHeight - bounds.bottom : \"auto\",\r\n                left: (bestX === \"left\" || !bounds) ? \"auto\" : bounds.right,\r\n                right: (bestX === \"left\" && bounds) ? window.innerWidth - bounds.left : \"auto\",\r\n            }}\r\n            {...restProps}\r\n        >\r\n            {children}\r\n        </div>\r\n    );\r\n\r\n    return ReactDOM.createPortal(portalChildren, document.body);\r\n};"]}