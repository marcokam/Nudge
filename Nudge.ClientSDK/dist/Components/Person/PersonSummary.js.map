{"version":3,"file":"PersonSummary.js","sourceRoot":"","sources":["../../../Components/Person/PersonSummary.tsx"],"names":[],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { useSpring, animated, config } from \"react-spring\";\r\n\r\nimport { Person } from \"~/Data/NudgeInterfaces\";\r\nimport { Cache } from \"~/Data/DataInterfaces\";\r\n\r\nimport * as logger from \"~/Logging/DefaultLogger\";\r\nimport { uriToId } from \"~/Uris/uriUtils\";\r\nimport { compose, noop } from \"~/Util/fp/function\";\r\nimport { filter } from \"~/Util/fp/array\";\r\nimport { propOr } from \"~/Util/fp/object\";\r\nimport { getEntity } from \"~/Util/apiUtils\";\r\nimport { NudgeUris } from \"~/Uris/NudgeUris\";\r\nimport { Identity, IdentityType, sortAndFilterIdentities } from \"~/Data/Identity/identityData\";\r\n\r\nimport { PersonProfileProps } from \"~/Components/Company/OrgChart/OrgChart\";\r\nimport { TeamInteractions } from \"~/Components/Team/TeamInteractions\";\r\nimport NudgeLink from \"~/Components/UI/Link/NudgeLink\";\r\nimport { socialIcons } from \"~/Components/Icons/Social/icons\";\r\nimport { ExternalLink } from \"~/Components/UI/Link/ExternalLink\";\r\nimport { option, tryCatch } from \"~/Util/fp/Instances/Option\";\r\nimport { EditIcon } from \"~/Components/Icons/Icons\";\r\nimport { flaggedDataReason, FlaggedDataReason } from \"~/Data/Person/Metadata/flagData\";\r\n\r\n\r\nconst defaultStyles = {\r\n    minWidth: \"24rem\",\r\n};\r\ninterface PersonSummaryProps {\r\n    person: Person;\r\n    PersonProfile: React.FunctionComponent<PersonProfileProps>;\r\n    style?: React.CSSProperties;\r\n    cache?: Cache;\r\n    flaggedUris?: Record<string,string>;\r\n    flagUri?: (uri: string, reason?: FlaggedDataReason) => void;\r\n}\r\ninterface Interaction {\r\n    type: string;\r\n    date: string;\r\n    displayDate?: string;\r\n    teammate?: Partial<Person>;\r\n};\r\n\r\nconst getUniqueIdentities = (identities: Identity[]) =>\r\n    option.of(identities)\r\n        .map(compose(\r\n            sortAndFilterIdentities,\r\n            filter(compose(\r\n                type => type !== \"facebook\",\r\n                propOr(\"type\", \"\"),\r\n            )),\r\n        ))\r\n        .getOrElse(() => [] as Identity[]);\r\n\r\n\r\nexport const PersonSummary: React.FunctionComponent<PersonSummaryProps> = ({\r\n    person,\r\n    PersonProfile,\r\n    style = defaultStyles,\r\n    cache,\r\n    flaggedUris = {},\r\n    flagUri = noop,\r\n}) => {\r\n    const { uri, name, title, imageUrl, teamInteractions = {}, identities: initialIdentities } = person;\r\n    const [identities, setIdentities] = useState(getUniqueIdentities(initialIdentities as Identity[]));\r\n    const [edited, setEdited] = useState(false);\r\n    const isEdited = edited || !!flaggedUris[uri];\r\n    const { transform, opacity, revOpacity } = useSpring({\r\n        opacity: isEdited ? 1 : 0,\r\n        revOpacity: isEdited ? 0 : 1,\r\n        transform: `perspective(600px) rotateX(${isEdited ? 180 : 0}deg)`,\r\n        config: config.stiff,\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (initialIdentities && initialIdentities.length === 0) {\r\n            return;\r\n        }\r\n        let cancelled = false;\r\n        getEntity(NudgeUris.v2.people(person.uri)._instanceUri, { fields: `uri,identities` }, { cache })\r\n            .fork(\r\n                err => {\r\n                    if (cancelled) return;\r\n                    logger.error(\"Error getting identities\", err);\r\n                },\r\n                ({ identities }: { identities: Identity[] }) => {\r\n                    if (cancelled) return;\r\n                    setIdentities(getUniqueIdentities(identities));\r\n                }\r\n            );\r\n\r\n        return () => {\r\n            cancelled = true;\r\n        }\r\n\r\n    }, [initialIdentities, person.uri, cache]);\r\n\r\n    return (\r\n        <div className=\"bg-white pa3 ba b--black-10 br2 shadow-4\" style={style}>\r\n            <header className=\"mb2\">\r\n                <div className=\"mt2\">\r\n                    <PersonProfile\r\n                        size={50}\r\n                        className=\"mw6\"\r\n                        name={name}\r\n                        title={title}\r\n                        imageUrl={imageUrl}\r\n                    />\r\n                </div>\r\n                {uri.startsWith(\"/v2/people\") &&\r\n                    <div className=\"flex items-center justify-between h2 mt2\">\r\n                        <div className=\"flex\">\r\n                            <NudgeLink\r\n                                className=\"link nudge-blue mv1 f6 hover-underline\"\r\n                                to={`/contactProfilePage?id=${uriToId(uri).getOrElse(() => \"\")}`}\r\n                                onClick={(event: Event) => {\r\n                                    event.stopPropagation();\r\n                                }}\r\n                            >\r\n                                View Profile\r\n                            </NudgeLink>\r\n                            {identities && identities.length > 0 && (\r\n                                <div className=\"flex items-center ml3\">\r\n                                    {identities.map(({ type = IdentityType.none, identity = \"\", externalUrl = \"\" }) =>\r\n                                        tryCatch(() => socialIcons[type as IdentityType])\r\n                                            .map(({ icon: Icon, style }) => (\r\n                                                <ExternalLink\r\n                                                    key={identity}\r\n                                                    href={externalUrl}\r\n                                                    className=\"dtc v-mid pr2 link dark-gray f7 dib\"\r\n                                                    title={\r\n                                                        type === \"twitter\"\r\n                                                            ? `@${identity}`\r\n                                                            : identity\r\n                                                    }\r\n                                                >\r\n                                                    <Icon style={style} />\r\n                                                </ExternalLink>\r\n                                            ))\r\n                                            .getOrElse(() => null))}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                        <div className=\"relative w4-5 h-100 flex items-center justify-end\">\r\n                            <animated.div\r\n                                className={`absolute link nudge-blue f7 hover-underline pointer flex ${isEdited ? \"\" : \"z-1\"}`}\r\n                                style={{ opacity: revOpacity, transform }}\r\n                                onClick={() => {\r\n                                    setEdited(state => !state);\r\n                                    flagUri(uri);\r\n                                }}\r\n                            >\r\n                                <EditIcon />\r\n                                <span className=\"ml1\">Flag as incorrect</span>\r\n                            </animated.div>\r\n                            <animated.div\r\n                                className=\"absolute pa1 bg-nudge-highlight-background nudge-highlight-text f7\"\r\n                                style={{ opacity, transform: transform.interpolate(t => `${t} rotateX(180deg)`) }}\r\n                            >\r\n                                <span>Thanks! We'll review and update this profile shortly.</span>\r\n                                <a className=\"link di underline pointer bg-animate hover-bg-washed-yellow ph1\" onClick={() => {\r\n                                    flagUri(uri, flaggedDataReason.incorrectCompany);\r\n                                }}>Hide profile</a>\r\n                            </animated.div>\r\n                        </div>\r\n                    </div>\r\n                }\r\n            </header>\r\n            <TeamInteractions interactions={teamInteractions} PersonProfile={PersonProfile} person={person}/>\r\n        </div>\r\n    );\r\n};"]}